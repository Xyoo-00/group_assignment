<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Manager</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI','Poppins',sans-serif}
        body{background:linear-gradient(135deg,#1a1a2e,#16213e);min-height:100vh;display:flex;justify-content:center;align-items:center;padding:15px}
        .dashboard{width:100%;max-width:1350px;height:95vh;display:grid;grid-template-columns:380px 1fr;gap:0;background:white;border-radius:20px;overflow:hidden;box-shadow:0 25px 60px rgba(0,0,0,0.5)}
        .sidebar{background:linear-gradient(165deg,#0c2461,#1e3799);padding:25px;display:flex;flex-direction:column}
        .logo{text-align:center;margin-bottom:30px;padding-bottom:20px;border-bottom:2px solid rgba(255,255,255,0.1)}
        .logo h1{font-size:1.8rem;font-weight:800;color:white;display:flex;align-items:center;justify-content:center;gap:12px}
        .logo p{color:rgba(255,255,255,0.7);font-size:0.85rem;margin-top:5px}
        .form-section{margin-top:10px}
        .form-title{color:white;font-size:1.3rem;font-weight:700;margin-bottom:20px;display:flex;align-items:center;gap:10px}
        .input-group{margin-bottom:15px}
        .input-group label{display:block;color:rgba(255,255,255,0.85);font-weight:600;margin-bottom:5px;font-size:0.85rem}
        .input-field{width:100%;padding:12px 15px;background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.15);border-radius:8px;font-size:0.95rem;color:white;transition:all 0.2s}
        .input-field:focus{outline:none;border-color:#4cd137;background:rgba(255,255,255,0.12);box-shadow:0 0 0 2px rgba(76,209,55,0.2)}
        .btn-add{width:100%;padding:14px;background:linear-gradient(135deg,#4cd137,#44bd32);color:white;border:none;border-radius:8px;font-size:1rem;font-weight:700;cursor:pointer;transition:all 0.3s;display:flex;align-items:center;justify-content:center;gap:10px;margin-top:15px}
        .btn-add:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(76,209,55,0.4)}
        .connection-status{background:rgba(76,209,55,0.15);color:#4cd137;padding:8px 12px;border-radius:15px;font-size:0.8rem;font-weight:600;text-align:center;margin-top:auto;border:1px solid rgba(76,209,55,0.3)}
        .main-content{display:flex;flex-direction:column;padding:25px}
        .top-bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:25px}
        .page-title h2{font-size:1.8rem;font-weight:800;color:#2d3436;display:flex;align-items:center;gap:12px}
        .page-title h2 i{color:#0c2461}
        .live-count{background:#0c2461;color:white;padding:10px 20px;border-radius:20px;font-weight:700;font-size:1rem;display:flex;align-items:center;gap:8px}
        .table-container{flex:1;border:1px solid #e0e0e0;border-radius:12px;overflow:hidden;background:#fafafa}
        table{width:100%;border-collapse:separate;border-spacing:0}
        thead{background:linear-gradient(135deg,#0c2461,#1e3799);position:sticky;top:0}
        th{padding:16px 14px;text-align:left;color:white;font-weight:700;font-size:0.9rem;white-space:nowrap}
        tbody tr{background:white;border-bottom:1px solid #f0f0f0;transition:background 0.2s}
        tbody tr:hover{background:#f8f9fa}
        td{padding:16px 14px;color:#2d3436;font-size:0.95rem}
        .student-name{font-weight:600;color:#2c3e50}
        .grade-badge{padding:5px 12px;border-radius:20px;font-weight:700;font-size:0.85rem;display:inline-block;min-width:65px;text-align:center}
        .grade-excellent{background:linear-gradient(135deg,#00b09b,#96c93d);color:white}
        .grade-good{background:linear-gradient(135deg,#3498db,#2980b9);color:white}
        .grade-average{background:linear-gradient(135deg,#f39c12,#e67e22);color:white}
        .grade-poor{background:linear-gradient(135deg,#e74c3c,#c0392b);color:white}
        .btn-delete{background:#e74c3c;color:white;border:none;border-radius:6px;cursor:pointer;font-weight:600;padding:7px 12px;font-size:0.85rem;display:flex;align-items:center;gap:5px;transition:all 0.2s}
        .btn-delete:hover{background:#c0392b;transform:translateY(-1px)}
        .stats-container{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-top:20px}
        .stat-card{background:linear-gradient(135deg,#0c2461,#1e3799);padding:20px;border-radius:12px;text-align:center;box-shadow:0 5px 15px rgba(12,36,97,0.2)}
        .stat-value{font-size:2.2rem;font-weight:800;color:#4cd137;margin-bottom:5px}
        .stat-label{color:rgba(255,255,255,0.9);font-size:0.9rem;font-weight:600}
        .empty-state{text-align:center;padding:50px 20px}
        .empty-icon{font-size:3rem;color:#ddd;margin-bottom:15px}
        .empty-state h3{color:#7f8c8d;font-size:1.3rem;margin-bottom:10px}
        .table-body{max-height:380px;overflow-y:auto}
        .table-body::-webkit-scrollbar{width:5px}
        .table-body::-webkit-scrollbar-track{background:#f1f1f1}
        .table-body::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:3px}
        
        @media (max-width:1024px){
            body{display:block;padding:0;min-height:100vh;height:auto}
            .dashboard{height:auto;min-height:100vh;grid-template-columns:1fr;grid-template-rows:auto auto;max-width:100%;border-radius:0;margin:0}
            .sidebar{order:1;min-height:auto;padding:20px}
            .main-content{order:2;min-height:auto;padding:20px;overflow:visible}
            .table-body{max-height:none;height:auto;overflow:visible}
            .table-container{overflow:visible}
            body,.dashboard{overflow-y:auto;overflow-x:hidden}
        }
        
        @media (max-width:480px){
            .logo h1{font-size:1.5rem}
            .top-bar{flex-direction:column;gap:15px;align-items:stretch}
            .live-count{justify-content:center}
            table{display:block;overflow-x:auto;white-space:nowrap}
            .stats-container{grid-template-columns:1fr}
            th,td{padding:12px 10px;font-size:0.9rem}
        }
        
        @media (hover:none) and (pointer:coarse){
            .btn-add,.btn-delete,.input-field{min-height:44px}
            .input-field{font-size:16px}
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="sidebar">
            <div class="logo">
                <h1><i class="fas fa-graduation-cap"></i> Student Manager</h1>
                <p>Cloud Database Management System</p>
            </div>
            
            <div class="form-section">
                <div class="form-title">
                    <i class="fas fa-user-plus"></i>
                    Add New Student
                </div>
                
                <div class="input-group">
                    <label>FULL NAME</label>
                    <input type="text" id="name" class="input-field" placeholder="">
                </div>
                
                <div class="input-group">
                    <label>EMAIL ADDRESS</label>
                    <input type="email" id="email" class="input-field" placeholder="">
                </div>
                
                <div class="input-group">
                    <label>AGE</label>
                    <input type="number" id="age" class="input-field" placeholder="">
                </div>
                
                <div class="input-group">
                    <label>GRADE (%)</label>
                    <input type="number" id="grade" class="input-field" placeholder="" min="0" max="100">
                </div>
                
                <button class="btn-add" onclick="addStudent()">
                    <i class="fas fa-save"></i>
                    Save Student
                </button>
            </div>
            
            <div class="connection-status" id="status">
                <i class="fas fa-circle" style="font-size:8px;margin-right:6px"></i>
                Connecting...
            </div>
        </div>
        
        <div class="main-content">
            <div class="top-bar">
                <div class="page-title">
                    <h2><i class="fas fa-users"></i> Student Records</h2>
                </div>
                <div class="live-count" id="studentCount">
                    <i class="fas fa-user-graduate"></i>
                    <span>0 Students</span>
                </div>
            </div>
            
            <div class="table-container">
                <div class="table-body">
                    <div id="emptyState" class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-user-graduate"></i>
                        </div>
                        <h3>No Students Found</h3>
                        <p>Add your first student to begin</p>
                    </div>
                    
                    <table id="studentsTable" style="display:none">
                        <thead>
                            <tr>
                                <th>STUDENT NAME</th>
                                <th>EMAIL</th>
                                <th>AGE</th>
                                <th>GRADE</th>
                                <th>ACTION</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-value" id="totalStudents">0</div>
                    <div class="stat-label">TOTAL STUDENTS</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgGrade">0%</div>
                    <div class="stat-label">AVERAGE GRADE</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCyBluIlub_Atjl96t0P3jvTYdxbvZC4hQ",
            authDomain: "studentmanagementapp-9902b.firebaseapp.com",
            projectId: "studentmanagementapp-9902b",
            storageBucket: "studentmanagementapp-9902b.firebasestorage.app",
            messagingSenderId: "209522191296",
            appId: "1:209522191296:web:4944c12a36e6d8ded07625",
            measurementId: "G-MX3J0Y34XL"
        };

        let students = [];

        function updateStatus(text, isConnected = true) {
            const status = document.getElementById('status');
            status.innerHTML = `<i class="fas fa-circle" style="font-size:8px;margin-right:6px;color:${isConnected ? '#4cd137' : '#e74c3c'}"></i> ${text}`;
            status.style.background = isConnected ? 'rgba(76,209,55,0.15)' : 'rgba(231,76,60,0.15)';
            status.style.color = isConnected ? '#4cd137' : '#e74c3c';
            status.style.borderColor = isConnected ? 'rgba(76,209,55,0.3)' : 'rgba(231,76,60,0.3)';
        }

        try {
            firebase.initializeApp(firebaseConfig);
            const db = firebase.firestore();
            updateStatus("Connected to Database", true);

            function loadStudents() {
                updateStatus("Loading...", false);
                
                db.collection("students").orderBy("created", "desc").get()
                    .then((snapshot) => {
                        students = [];
                        let totalGrade = 0;
                        
                        if (snapshot.empty) {
                            document.getElementById('emptyState').style.display = 'block';
                            document.getElementById('studentsTable').style.display = 'none';
                            updateStatus("No students in database", false);
                            document.getElementById('studentCount').innerHTML = '<i class="fas fa-user-graduate"></i><span>0 Students</span>';
                        } else {
                            document.getElementById('emptyState').style.display = 'none';
                            document.getElementById('studentsTable').style.display = 'table';
                            
                            const tbody = document.querySelector('#studentsTable tbody');
                            tbody.innerHTML = '';
                            
                            snapshot.forEach((doc) => {
                                const data = doc.data();
                                const student = {
                                    id: doc.id,
                                    name: data.name || '',
                                    email: data.email || '',
                                    age: data.age || 0,
                                    grade: data.grade || 0
                                };
                                
                                students.push(student);
                                totalGrade += student.grade;
                                
                                const row = tbody.insertRow();
                                let gradeClass = 'grade-poor';
                                if (student.grade >= 90) gradeClass = 'grade-excellent';
                                else if (student.grade >= 80) gradeClass = 'grade-good';
                                else if (student.grade >= 70) gradeClass = 'grade-average';
                                
                                row.innerHTML = `
                                    <td class="student-name">${student.name}</td>
                                    <td>${student.email}</td>
                                    <td>${student.age}</td>
                                    <td><span class="grade-badge ${gradeClass}">${student.grade}%</span></td>
                                    <td>
                                        <button class="btn-delete" onclick="deleteStudent('${student.id}')">
                                            <i class="fas fa-trash-alt"></i> Delete
                                        </button>
                                    </td>
                                `;
                            });
                            
                            const total = students.length;
                            const avgGrade = total > 0 ? Math.round(totalGrade / total) : 0;
                            
                            document.getElementById('totalStudents').textContent = total;
                            document.getElementById('avgGrade').textContent = avgGrade + '%';
                            document.getElementById('studentCount').innerHTML = `<i class="fas fa-user-graduate"></i><span>${total} Student${total !== 1 ? 's' : ''}</span>`;
                            
                            updateStatus(`${total} students loaded`, true);
                        }
                    })
                    .catch((error) => {
                        updateStatus("Error loading data", false);
                        console.error(error);
                    });
            }

            window.addStudent = function() {
                const name = document.getElementById('name').value.trim();
                const email = document.getElementById('email').value.trim();
                const age = document.getElementById('age').value;
                const grade = document.getElementById('grade').value;
                
                if (!name || !email || !age || !grade) {
                    updateStatus("Please fill all fields", false);
                    return;
                }
                
                if (grade < 0 || grade > 100) {
                    updateStatus("Grade must be 0-100", false);
                    return;
                }
                
                updateStatus("Saving student...", false);
                
                db.collection("students").add({
                    name: name,
                    email: email,
                    age: parseInt(age),
                    grade: parseInt(grade),
                    created: new Date().toISOString()
                })
                .then(() => {
                    document.getElementById('name').value = '';
                    document.getElementById('email').value = '';
                    document.getElementById('age').value = '';
                    document.getElementById('grade').value = '';
                    
                    updateStatus("Student saved successfully!", true);
                    setTimeout(() => loadStudents(), 800);
                })
                .catch((error) => {
                    updateStatus("Failed to save student", false);
                    console.error(error);
                });
            }

            window.deleteStudent = function(studentId) {
                if (!confirm("Are you sure you want to delete this student?")) return;
                
                updateStatus("Deleting student...", false);
                
                db.collection("students").doc(studentId).delete()
                    .then(() => {
                        updateStatus("Student deleted", true);
                        setTimeout(() => loadStudents(), 800);
                    })
                    .catch((error) => {
                        updateStatus("Failed to delete", false);
                        console.error(error);
                    });
            }

            loadStudents();
            
        } catch (error) {
            updateStatus("Database connection failed", false);
            console.error(error);
        }

        window.addEventListener('DOMContentLoaded', function() {
            document.addEventListener('touchstart', function() {}, {passive: true});
            
            if ('ontouchstart' in window) {
                document.querySelectorAll('.btn-add, .btn-delete, .input-field').forEach(el => {
                    el.style.minHeight = '44px';
                });
            }
        });
    </script>
</body>
</html>
